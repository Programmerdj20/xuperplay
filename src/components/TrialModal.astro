---
import X from './icons/X.astro';
import logo from '../assets/images/logos/Xuper_play_logo.webp';
---

<!-- Modal Backdrop -->
<div
  id="trialModal"
  class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm z-50 flex items-center justify-center p-4 opacity-0 pointer-events-none transition-opacity duration-300"
>
  <!-- Modal Container -->
  <div
    class="bg-white rounded-2xl shadow-2xl max-w-md w-full transform scale-95 transition-transform duration-300"
    id="modalContent"
  >
    <!-- Modal Header -->
    <div class="relative bg-gradient-to-r from-blue-500 to-purple-600 rounded-t-2xl p-6">
      <!-- Close Button -->
      <button
        id="closeTrialModal"
        class="absolute top-4 right-4 text-white hover:bg-white hover:bg-opacity-20 rounded-full p-2 transition-all duration-200"
        aria-label="Cerrar modal"
      >
        <X size={24} />
      </button>

      <!-- Logo and Title -->
      <div class="flex flex-col items-center text-center">
        <img
          src={logo.src}
          alt="Xuper Play Logo"
          class="h-16 w-auto mb-4 drop-shadow-lg"
        />
        <h2 class="text-2xl font-bold text-white mb-2">
          Prueba Gratis por 7 D√≠as
        </h2>
        <p class="text-blue-100 text-sm">
          Descubre todo lo que tenemos para ti
        </p>
      </div>
    </div>

    <!-- Modal Body -->
    <div class="p-6">
      <!-- Form -->
      <form id="trialForm" class="space-y-4">
        <!-- Nombre -->
        <div>
          <label for="nombre" class="block text-sm font-semibold text-gray-700 mb-2">
            Nombre Completo
          </label>
          <input
            type="text"
            id="nombre"
            name="nombre"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 outline-none"
            placeholder="Ingresa tu nombre"
          />
        </div>

        <!-- Celular -->
        <div>
          <label for="celular" class="block text-sm font-semibold text-gray-700 mb-2">
            N√∫mero de Celular
          </label>
          <input
            type="tel"
            id="celular"
            name="celular"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 outline-none"
            placeholder="+52 123 456 7890"
          />
        </div>

        <!-- Tipo de Solicitud -->
        <div>
          <label for="solicitud" class="block text-sm font-semibold text-gray-700 mb-2">
            ¬øQu√© necesitas?
          </label>
          <select
            id="solicitud"
            name="solicitud"
            required
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all duration-200 outline-none appearance-none bg-white cursor-pointer"
          >
            <option value="">Selecciona una opci√≥n</option>
            <option value="prueba">Quiero una prueba de 7 d√≠as</option>
            <option value="ayuda">Necesito ayuda para instalar la aplicaci√≥n</option>
          </select>
        </div>

        <!-- Advertencia -->
        <div class="bg-amber-50 border border-amber-200 rounded-lg p-4">
          <div class="flex items-start gap-3">
            <svg class="w-5 h-5 text-amber-600 mt-0.5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
              <path fill-rule="evenodd" d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z" clip-rule="evenodd"></path>
            </svg>
            <div>
              <p class="text-sm font-semibold text-amber-800 mb-1">Nota importante</p>
              <p class="text-sm text-amber-700">
                La prueba gratuita es v√°lida para un √∫nico dispositivo.
              </p>
            </div>
          </div>
        </div>

        <!-- Submit Button -->
        <button
          type="submit"
          class="w-full py-4 gradient-primary text-white font-bold rounded-lg hover:shadow-xl hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
          Solicitar Prueba Gratis
        </button>
      </form>
    </div>
  </div>
</div>

<script>
  // Elementos del DOM
  const modal = document.getElementById('trialModal');
  const modalContent = document.getElementById('modalContent');
  const openBtn = document.getElementById('openTrialModal');
  const closeBtn = document.getElementById('closeTrialModal');
  const form = document.getElementById('trialForm') as HTMLFormElement;

  // Funci√≥n para abrir el modal
  function openModal() {
    if (modal) {
      modal.classList.remove('pointer-events-none', 'opacity-0');
      modal.classList.add('opacity-100');
      setTimeout(() => {
        modalContent?.classList.remove('scale-95');
        modalContent?.classList.add('scale-100');
      }, 10);
      document.body.style.overflow = 'hidden';
    }
  }

  // Funci√≥n para cerrar el modal
  function closeModal() {
    if (modal) {
      modalContent?.classList.remove('scale-100');
      modalContent?.classList.add('scale-95');
      modal.classList.remove('opacity-100');
      modal.classList.add('opacity-0');
      setTimeout(() => {
        modal.classList.add('pointer-events-none');
        document.body.style.overflow = '';
      }, 300);
    }
  }

  // Event Listeners
  openBtn?.addEventListener('click', openModal);
  closeBtn?.addEventListener('click', closeModal);

  // Cerrar al hacer clic fuera del modal
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      closeModal();
    }
  });

  // Cerrar con la tecla ESC
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && modal?.classList.contains('opacity-100')) {
      closeModal();
    }
  });

  // Manejar el env√≠o del formulario
  form?.addEventListener('submit', (e) => {
    e.preventDefault();

    const formData = new FormData(form);
    const nombre = formData.get('nombre');
    const celular = formData.get('celular');
    const solicitud = formData.get('solicitud');

    // Obtener el texto de la opci√≥n seleccionada
    const selectElement = document.getElementById('solicitud') as HTMLSelectElement;
    const solicitudTexto = selectElement.options[selectElement.selectedIndex].text;

    // Crear mensaje para WhatsApp
    const mensaje = `*Nueva Solicitud - Xuper Play*\n\n` +
                   `üë§ *Nombre:* ${nombre}\n` +
                   `üì± *Celular:* ${celular}\n` +
                   `üìù *Solicitud:* ${solicitudTexto}`;

    // Codificar el mensaje para URL
    const mensajeCodificado = encodeURIComponent(mensaje);

    // N√∫mero de WhatsApp
    const whatsappNumber = '573014034646';

    // Crear URL de WhatsApp
    const whatsappURL = `https://wa.me/${whatsappNumber}?text=${mensajeCodificado}`;

    // Abrir WhatsApp en nueva ventana
    window.open(whatsappURL, '_blank');

    // Cerrar el modal y resetear el formulario
    closeModal();
    setTimeout(() => {
      form.reset();
    }, 300);
  });
</script>

<style>
  /* Custom select arrow */
  select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
    background-position: right 0.75rem center;
    background-repeat: no-repeat;
    background-size: 1.5em 1.5em;
    padding-right: 2.5rem;
  }
</style>
