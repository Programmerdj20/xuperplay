---
import ChevronLeft from './icons/ChevronLeft.astro';
import ChevronRight from './icons/ChevronRight.astro';
import Play from './icons/Play.astro';
import Tv from './icons/Tv.astro';
import { Image } from 'astro:assets';

// INSTRUCCIONES: Coloca tus imágenes en src/assets/images/hero/
// Nombres recomendados: slide-1.jpg, slide-2.jpg, slide-3.jpg
// Formatos soportados: JPG, PNG, WebP (se convertirán automáticamente a WebP/AVIF)
// Tamaño recomendado: 1920x1080px o superior

// Importa tus imágenes aquí:
import slide1Image from '../assets/images/hero/herobg_3.webp';
import slide2Image from '../assets/images/hero/herobg_2.webp';

// Imágenes de contenido para el slide 1
import tvEnVivoImg from '../assets/images/hero/tv-en-vivo.webp';
import peliculasImg from '../assets/images/hero/pelicilas-.webp';
import animeImg from '../assets/images/hero/anime-y-dibujos.webp';
import seriesImg from '../assets/images/hero/series.webp';

const slides = [
  {
    title: 'Todo lo que quieres ver en una misma app',
    description:
      'Tu mejor opción para ver contenido en vivo sin límites y disfrutar de un amplio catálogo de películas y series siempre actualizado con lo todo lo ultimo.',
    image: slide1Image,
    contentImages: [
      { src: tvEnVivoImg, alt: 'TV en Vivo - Fútbol y más' },
      { src: peliculasImg, alt: 'Películas - New y clásicos' },
      { src: animeImg, alt: 'Anime y dibujos - Tiempo con familia' },
      { src: seriesImg, alt: 'Series y Películas - Recién agregado' },
    ],
  },
  {
    title: 'Xuper Play: tu app magica de entretenimiento sin limites.',
    description: 'Descarga y disfruta de Xuper Play en tu celular, TV Box, Smart TV o Fire TV Stick. Xuper Play ofrece contenido VOD, animes, deportes, infantles, para toda la familia y sin anuncios.',
    image: slide2Image,
    downloadSection: true,
    downloadButtons: [
      { text: 'Para TV / TV Stick', icon: Tv, link: '/downloads/xplay.apk' },
      { text: 'Para Celular', icon: Play, link: '/downloads/xplay.apk' },
    ],
  },
];
---

<section
  id="inicio"
  class="relative h-screen w-full overflow-hidden bg-gray-900 pt-20"
>
  <!-- Carousel Container -->
  <div id="carousel" class="relative h-full w-full">
    {
      slides.map((slide, index) => (
        <div
          class={`carousel-slide absolute inset-0 transition-all duration-1000 ease-in-out ${index === 0 ? 'opacity-100 translate-x-0 z-10' : 'opacity-0 translate-x-full z-0'}`}
          data-slide={index}
        >
          {/* Background Image (cuando esté disponible) */}
          {slide.image && (
            <Image
              src={slide.image}
              alt={slide.title}
              class="absolute inset-0 w-full h-full object-cover"
              loading={index === 0 ? 'eager' : 'lazy'}
              fetchpriority={index === 0 ? 'high' : 'auto'}
              widths={[768, 1920]}
              sizes="100vw"
            />
          )}

          {/* Gradient overlay para legibilidad del texto */}
          <div
            class={`absolute inset-0 ${slide.image ? 'bg-gradient-to-b from-gray-900/70 via-gray-900/60 to-gray-900/80' : 'gradient-primary opacity-90'}`}
          />

          {/* Content */}
          <div class="relative h-full flex items-center justify-center py-16 md:py-16">
            <div class="container mx-auto px-4 text-center text-white">
              <div class="max-w-5xl mx-auto space-y-2 md:space-y-6">
                {/* Icon (solo se muestra si no hay imagen de fondo) */}
                {!slide.image && slide.icon && (
                  <div class="flex justify-center mb-3 md:mb-6">
                    <slide.icon size={64} class="animate-pulse" />
                  </div>
                )}

                {/* Title */}
                <h1 class="text-2xl sm:text-3xl md:text-5xl lg:text-6xl font-bold leading-tight text-white px-2">
                  {slide.title}
                </h1>

                {/* Subtitle (si existe) */}
                {slide.subtitle && (
                  <p class="text-base sm:text-lg md:text-2xl lg:text-3xl text-white font-semibold max-w-3xl mx-auto px-2">
                    {slide.subtitle}
                  </p>
                )}

                {/* Description (si existe) */}
                {slide.description && (
                  <p class="text-xs sm:text-sm md:text-lg lg:text-xl text-white/90 max-w-3xl mx-auto px-2 leading-snug md:leading-normal">
                    {slide.description}
                  </p>
                )}

                {/* Content Images Grid (si existen) */}
                {slide.contentImages && (
                  <div class="pt-2 md:pt-6 flex justify-center gap-1.5 sm:gap-2 md:gap-4 lg:gap-6 flex-wrap max-w-4xl mx-auto">
                    {slide.contentImages.map((img) => (
                      <div class="w-20 sm:w-24 md:w-36 lg:w-48 rounded-md md:rounded-lg overflow-hidden shadow-lg hover:scale-105 transition-transform duration-300">
                        <Image
                          src={img.src}
                          alt={img.alt}
                          class="w-full h-full object-cover"
                          loading="lazy"
                          widths={[96, 192]}
                          sizes="(max-width: 640px) 80px, (max-width: 768px) 96px, (max-width: 1024px) 144px, 192px"
                        />
                      </div>
                    ))}
                  </div>
                )}

                {/* Download Section (si existe) */}
                {slide.downloadSection && slide.downloadButtons && (
                  <div class="pt-4 md:pt-8 space-y-3 md:space-y-4">
                    <p class="text-lg md:text-xl lg:text-2xl font-bold text-white uppercase tracking-wide">
                      DESCARGAR
                    </p>
                    <div class="flex flex-col sm:flex-row gap-3 md:gap-4 justify-center items-center px-4">
                      {slide.downloadButtons.map((button) => (
                        <a
                          href={button.link}
                          download
                          class="group flex items-center gap-2 md:gap-3 px-6 md:px-8 py-3 md:py-4 bg-white text-gray-900 rounded-lg font-bold text-base md:text-lg hover:bg-primary-500 hover:text-white hover:scale-105 transition-all duration-300 shadow-xl min-w-[200px] md:min-w-60 justify-center"
                        >
                          <button.icon size={20} class="md:w-6 md:h-6 group-hover:scale-110 transition-transform" />
                          <span>{button.text}</span>
                        </a>
                      ))}
                    </div>
                  </div>
                )}

                {/* CTA Button (si existe) */}
                {slide.cta && slide.ctaLink && (
                  <div class="pt-3 md:pt-4">
                    <a
                      href={slide.ctaLink}
                      class="inline-block px-6 md:px-8 py-3 md:py-4 bg-white text-primary-600 rounded-lg font-bold text-base md:text-lg hover:bg-gray-100 hover:scale-105 transition-all duration-300 shadow-xl"
                    >
                      {slide.cta}
                    </a>
                  </div>
                )}
              </div>
            </div>
          </div>
        </div>
      ))
    }
  </div>

  <!-- Navigation Arrows -->
  <button
    id="prev-slide"
    class="absolute left-2 md:left-8 top-1/2 -translate-y-1/2 z-20 p-2 md:p-3 bg-white/10 hover:bg-white/30 backdrop-blur-sm rounded-full transition-all duration-300 group opacity-50 hover:opacity-100"
    aria-label="Slide anterior"
  >
    <ChevronLeft
      size={24}
      class="md:w-8 md:h-8 text-white group-hover:scale-110 transition-transform"
    />
  </button>

  <button
    id="next-slide"
    class="absolute right-2 md:right-8 top-1/2 -translate-y-1/2 z-20 p-2 md:p-3 bg-white/10 hover:bg-white/30 backdrop-blur-sm rounded-full transition-all duration-300 group opacity-50 hover:opacity-100"
    aria-label="Siguiente slide"
  >
    <ChevronRight
      size={24}
      class="md:w-8 md:h-8 text-white group-hover:scale-110 transition-transform"
    />
  </button>

  <!-- Indicators -->
  <div class="absolute bottom-4 md:bottom-8 left-1/2 -translate-x-1/2 z-20 flex gap-2 md:gap-3">
    {
      slides.map((_, index) => (
        <button
          class={`indicator w-2 h-2 md:w-3 md:h-3 rounded-full transition-all duration-300 ${index === 0 ? 'bg-white w-6 md:w-8' : 'bg-white/50 hover:bg-white/75'}`}
          data-slide-to={index}
          aria-label={`Ir a slide ${index + 1}`}
        />
      ))
    }
  </div>
</section>

<script>
  let currentSlide = 0;
  const slides = document.querySelectorAll('.carousel-slide');
  const indicators = document.querySelectorAll('.indicator');
  const totalSlides = slides.length;

  function showSlide(index: number, direction: 'next' | 'prev' = 'next') {
    const oldIndex = currentSlide;

    // Hide all slides with slide out animation
    slides.forEach((slide, i) => {
      slide.classList.remove('opacity-100', 'translate-x-0', 'z-10');
      if (i === oldIndex) {
        // Slide out: current slide moves out in opposite direction
        slide.classList.add(
          'opacity-0',
          direction === 'next' ? '-translate-x-full' : 'translate-x-full',
          'z-0',
        );
      } else {
        slide.classList.add('opacity-0', 'translate-x-full', 'z-0');
      }
    });

    // Update indicators
    indicators.forEach((indicator) => {
      indicator.classList.remove('bg-white', 'w-6', 'w-8', 'md:w-8');
      indicator.classList.add('bg-white/50');
    });

    // Show new slide with slide in animation
    slides[index].classList.remove(
      'opacity-0',
      '-translate-x-full',
      'translate-x-full',
      'z-0',
    );
    slides[index].classList.add('opacity-100', 'translate-x-0', 'z-10');

    // Update current indicator
    indicators[index].classList.remove('bg-white/50');
    indicators[index].classList.add('bg-white', 'w-6', 'md:w-8');

    currentSlide = index;
  }

  function nextSlide() {
    const next = (currentSlide + 1) % totalSlides;
    showSlide(next, 'next');
  }

  function prevSlide() {
    const prev = (currentSlide - 1 + totalSlides) % totalSlides;
    showSlide(prev, 'prev');
  }

  // Event listeners
  document.getElementById('next-slide')?.addEventListener('click', nextSlide);
  document.getElementById('prev-slide')?.addEventListener('click', prevSlide);

  // Indicator click events
  indicators.forEach((indicator, index) => {
    indicator.addEventListener('click', () => {
      const direction = index > currentSlide ? 'next' : 'prev';
      showSlide(index, direction);
    });
  });

  // Keyboard navigation
  document.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowLeft') prevSlide();
    if (e.key === 'ArrowRight') nextSlide();
  });

  // Auto-play con transición suave cada 6 segundos
  let autoplayInterval = setInterval(nextSlide, 6000);

  // Pausar auto-play al interactuar con el carousel
  const carouselSection = document.getElementById('inicio');
  carouselSection?.addEventListener('mouseenter', () => {
    clearInterval(autoplayInterval);
  });

  // Reanudar auto-play al salir del carousel
  carouselSection?.addEventListener('mouseleave', () => {
    autoplayInterval = setInterval(nextSlide, 6000);
  });
</script>
