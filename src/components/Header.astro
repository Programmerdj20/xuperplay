---
import { Image } from 'astro:assets';
import logoImage from '../assets/images/logos/Xuper_play_logo.webp';

const navItems = [
  { name: 'Inicio', href: '/#inicio' },
  { name: 'Características', href: '/#caracteristicas' },
  { name: 'Planes', href: '/#planes' },
  { name: 'Instalación', href: '/instalacion' },
  { name: 'FAQs', href: '/#faqs' },
  { name: 'Contacto', href: '/#contacto' },
];
---

<header class="fixed top-0 left-0 right-0 z-50 bg-gray-900/95 backdrop-blur-sm shadow-lg">
  <nav class="container mx-auto px-4 py-4">
    <div class="flex items-center justify-between">
      <!-- Logo -->
      <a href="/" class="flex items-center z-50 relative">
        <Image src={logoImage} alt="XuperPlay" class="h-10 w-auto" loading="eager" />
      </a>

      <!-- Desktop Navigation -->
      <ul class="hidden md:flex items-center gap-8">
        {navItems.map((item) => (
          <li>
            <a
              href={item.href}
              class="text-gray-300 hover:text-primary-500 transition-colors duration-300 font-medium"
            >
              {item.name}
            </a>
          </li>
        ))}
      </ul>

      <!-- CTA Button Desktop -->
      <a
        href="/downloads/xplay.apk"
        download
        class="hidden md:inline-block px-6 py-2.5 gradient-primary text-white rounded-lg font-semibold hover:shadow-lg hover:scale-105 transition-all duration-300"
      >
        Descargar
      </a>

      <!-- Mobile Menu Button - Icono único de puntos a líneas -->
      <button
        id="mobile-menu-button"
        class="md:hidden relative z-50 p-3 rounded-xl hover:bg-gray-800/50 transition-all duration-300 text-gray-300"
        aria-label="Abrir menú"
        aria-expanded="false"
      >
        <div class="menu-icon-modern">
          <span class="dot dot-1"></span>
          <span class="dot dot-2"></span>
          <span class="dot dot-3"></span>
        </div>
      </button>
    </div>
  </nav>
</header>

<!-- Mobile Menu Overlay -->
<div
  id="mobile-menu-overlay"
  class="fixed inset-0 bg-gradient-to-br from-black/70 via-black/80 to-black/90 backdrop-blur-md z-[60] md:hidden pointer-events-none opacity-0 transition-opacity duration-500"
  aria-hidden="true"
></div>

<!-- Mobile Menu Panel -->
<div
  id="mobile-menu"
  class="fixed top-0 right-0 bottom-0 w-[85%] max-w-sm bg-gradient-to-br from-gray-900 via-gray-850 to-gray-900 shadow-2xl z-[70] md:hidden overflow-y-auto"
>
  <div class="flex flex-col h-full min-h-screen">
    <!-- Menu Header con diseño moderno -->
    <div class="relative p-6 pb-8 border-b border-gray-700/30">
      <!-- Decoración de fondo -->
      <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-primary-500/10 to-transparent rounded-full blur-3xl"></div>

      <div class="relative flex items-center justify-between">
        <div class="flex items-center">
          <Image src={logoImage} alt="XuperPlay" class="h-8 w-auto" loading="eager" />
        </div>
        <button
          id="mobile-menu-close"
          class="p-2.5 text-white hover:bg-gray-800/60 rounded-xl transition-all duration-200 hover:rotate-90"
          aria-label="Cerrar menú"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>

    <!-- Menu Content -->
    <nav class="flex-1 px-5 py-8 space-y-2">
      {navItems.map((item, index) => (
        <a
          href={item.href}
          class="menu-link block relative px-6 py-4 text-gray-200 rounded-2xl transition-all duration-300 font-medium text-[15px] group overflow-hidden"
          data-index={index}
        >
          <!-- Efecto hover de fondo -->
          <div class="absolute inset-0 bg-gradient-to-r from-primary-500/0 to-primary-500/0 group-hover:from-primary-500/10 group-hover:to-primary-600/5 transition-all duration-300 rounded-2xl"></div>

          <!-- Borde animado -->
          <div class="absolute inset-0 border border-gray-700/0 group-hover:border-primary-500/30 rounded-2xl transition-all duration-300"></div>

          <div class="relative flex items-center justify-between">
            <span class="text-gray-200 group-hover:text-white transition-colors duration-300">{item.name}</span>
            <svg class="w-5 h-5 text-gray-400 group-hover:text-primary-400 group-hover:translate-x-1 transition-all duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 7l5 5m0 0l-5 5m5-5H6" />
            </svg>
          </div>
        </a>
      ))}
    </nav>

    <!-- Menu Footer -->
    <div class="relative p-6 pt-8 border-t border-gray-700/30 space-y-4">
      <!-- Decoración de fondo -->
      <div class="absolute bottom-0 left-0 w-32 h-32 bg-gradient-to-tr from-primary-500/10 to-transparent rounded-full blur-3xl"></div>

      <div class="relative">
        <a
          href="/downloads/xplay.apk"
          download
          class="menu-link block w-full text-center px-6 py-4 bg-gradient-to-r from-primary-500 to-primary-600 text-white rounded-2xl font-semibold shadow-lg shadow-primary-500/20 hover:shadow-xl hover:shadow-primary-500/40 transition-all duration-300 transform hover:scale-[1.02] active:scale-[0.98]"
        >
          <div class="flex items-center justify-center gap-3">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            <span>Descargar App</span>
          </div>
        </a>

        <div class="mt-4 flex items-center justify-center gap-2 text-gray-500 text-sm">
          <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div>
          <span>XuperPlay v1.0</span>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  /* Icono moderno: Puntos que se transforman en líneas */
  .menu-icon-modern {
    width: 28px;
    height: 28px;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }

  .dot {
    width: 5px;
    height: 5px;
    background: currentColor;
    border-radius: 50%;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    position: relative;
  }

  /* Estado cerrado: puntos alineados verticalmente */
  .dot::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 5px;
    height: 5px;
    background: currentColor;
    border-radius: 50%;
    opacity: 1;
    transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
  }

  .dot-1 {
    transform: translateY(0);
  }

  .dot-2 {
    transform: translateY(0);
  }

  .dot-3 {
    transform: translateY(0);
  }

  /* Estado abierto: puntos se convierten en líneas */
  .menu-icon-modern.active .dot::before {
    width: 24px;
    height: 3px;
    border-radius: 3px;
  }

  .menu-icon-modern.active .dot-1 {
    transform: translateY(7px) rotate(45deg);
  }

  .menu-icon-modern.active .dot-1::before {
    transform: translate(-50%, -50%) rotate(0deg);
  }

  .menu-icon-modern.active .dot-2 {
    opacity: 0;
    transform: scale(0);
  }

  .menu-icon-modern.active .dot-3 {
    transform: translateY(-7px) rotate(-45deg);
  }

  .menu-icon-modern.active .dot-3::before {
    transform: translate(-50%, -50%) rotate(0deg);
  }

  /* Hover effect en el botón */
  #mobile-menu-button:hover .dot {
    background: #818cf8;
  }

  /* Animaciones para el menú */
  #mobile-menu {
    transform: translateX(100%);
    transition: transform 0.4s cubic-bezier(0.22, 1, 0.36, 1);
  }

  #mobile-menu.show {
    transform: translateX(0);
  }

  #mobile-menu-overlay.show {
    opacity: 1 !important;
    pointer-events: all !important;
  }

  /* Animación staggered para los links */
  @keyframes slideInFadeScale {
    from {
      opacity: 0;
      transform: translateX(30px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateX(0) scale(1);
    }
  }

  /* Estado inicial: links visibles */
  .menu-link {
    opacity: 1;
  }

  #mobile-menu.show .menu-link {
    animation: slideInFadeScale 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    opacity: 0;
  }

  #mobile-menu.show .menu-link[data-index="0"] {
    animation-delay: 0.1s;
  }

  #mobile-menu.show .menu-link[data-index="1"] {
    animation-delay: 0.15s;
  }

  #mobile-menu.show .menu-link[data-index="2"] {
    animation-delay: 0.2s;
  }

  #mobile-menu.show .menu-link[data-index="3"] {
    animation-delay: 0.25s;
  }

  #mobile-menu.show .menu-link[data-index="4"] {
    animation-delay: 0.3s;
  }

  /* Último link del footer también se anima */
  #mobile-menu.show nav + div .menu-link {
    animation: slideInFadeScale 0.5s cubic-bezier(0.22, 1, 0.36, 1) forwards;
    animation-delay: 0.35s;
    opacity: 0;
  }

  /* Prevenir scroll del body */
  body.menu-open {
    overflow: hidden;
  }

  /* Color de fondo personalizado */
  .from-gray-850 {
    --tw-gradient-from: #1a1d29;
  }
</style>

<script>
  // Mobile menu elements
  const menuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const mobileMenuOverlay = document.getElementById('mobile-menu-overlay');
  const menuCloseButton = document.getElementById('mobile-menu-close');
  const menuIcon = menuButton?.querySelector('.menu-icon-modern');
  const body = document.body;

  // Function to open menu
  function openMenu() {
    mobileMenu?.classList.add('show');
    mobileMenuOverlay?.classList.add('show');
    menuIcon?.classList.add('active');
    body.classList.add('menu-open');
    menuButton?.setAttribute('aria-expanded', 'true');
  }

  // Function to close menu
  function closeMenu() {
    mobileMenu?.classList.remove('show');
    mobileMenuOverlay?.classList.remove('show');
    menuIcon?.classList.remove('active');
    body.classList.remove('menu-open');
    menuButton?.setAttribute('aria-expanded', 'false');
  }

  // Toggle menu on button click
  menuButton?.addEventListener('click', (e) => {
    e.stopPropagation();
    const isOpen = mobileMenu?.classList.contains('show');
    if (isOpen) {
      closeMenu();
    } else {
      openMenu();
    }
  });

  // Close menu when clicking close button
  menuCloseButton?.addEventListener('click', (e) => {
    e.stopPropagation();
    closeMenu();
  });

  // Close menu when clicking overlay
  mobileMenuOverlay?.addEventListener('click', closeMenu);

  // Close mobile menu when clicking on any link
  const mobileMenuLinks = document.querySelectorAll('.menu-link');
  mobileMenuLinks.forEach((link) => {
    link.addEventListener('click', () => {
      setTimeout(closeMenu, 300); // Pequeño delay para mejor UX
    });
  });

  // Close menu on scroll (only when scrolling down)
  let lastScroll = 0;
  window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;
    if (currentScroll > lastScroll && currentScroll > 100) {
      closeMenu();
    }
    lastScroll = currentScroll;
  });

  // Close menu on ESC key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && mobileMenu?.classList.contains('show')) {
      closeMenu();
    }
  });

  // Prevent clicks inside menu from closing it
  mobileMenu?.addEventListener('click', (e) => {
    e.stopPropagation();
  });
</script>
